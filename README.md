# 名古屋市スポーツ施設 空き状況検索ツール

名古屋市の公共スポーツ施設の空き状況を自動で検索し、CSV形式で出力するPythonスクリプトです。

## 概要

このツールは名古屋市公式サイトの「スポーツ施設予約システム」からWebスクレイピングで空き状況情報を取得します。指定した期間（デフォルト30日間）について、対象となるスポーツ施設の利用可能な時間帯を一括で検索できます。

## 使用技術

- **Python 3.x**
- **Selenium**: Webスクレイピングと自動操作
- **Pandas**: データ処理とCSV出力
- **webdriver-manager**: ChromeDriverの自動管理

## インストール

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

### 2. 必要な環境

- Python 3.6以上
- Google Chrome ブラウザ（最新版推奨）
- インターネット接続

## 使い方

### 基本的な実行方法

```bash
python main.py
```

スクリプト実行後、以下の処理が行われます：
1. ブラウザウィンドウが開き、自動で検索フォームに入力
2. 指定した期間の各日付について順次検索を実行
3. 検索結果を集約し、CSVファイルに出力

## 設定方法

`main.py` の設定エリア（先頭付近）で以下のパラメータを調整できます：

```python
TARGET_URL = "https://www.net.city.nagoya.jp/cgi-bin/sp/sps04001"  # 検索対象URL
TARGET_SPORT_VALUE = "023"  # スポーツ種別（023:バスケットボール, 015:サッカーなど）
SEARCH_DAYS = 30             # 検索日数（デフォルト30日）
OUTPUT_FILE_NAME = f"空き状況_{datetime.date.today()}.csv"  # 出力ファイル名
```

### スポーツ種別コード例

| コード | スポーツ種別 |
|--------|------------|
| 023 | バスケットボール |
| 015 | サッカー |
| その他 | 施設に応じて異なります |

## 出力形式

CSV形式で以下の列が出力されます：

| 列名 | 説明 |
|------|------|
| 検索日付 | 検索対象の日付（YYYY-MM-DD形式） |
| No. | 検索結果内での番号 |
| 地域 | 施設がある区（例：熱田区、西区） |
| 施設 | スポーツ施設の名称 |
| 月日 | 利用可能な日付 |
| 供用区分 | 利用可能な時間帯（例：09:00-12:00） |
| 予約 | 予約状況 |

### 出力ファイル例

```
空き状況_2026-01-28.csv
```

ファイル名は実行日付を含めて自動生成されます。

## 処理の詳細

1. **フォーム入力**: Seleniumでスポーツ種別、日付、供用区分、地域を自動選択
2. **検索実行**: 「照会」ボタンをクリックして検索
3. **HTML解析**: Pandasで返されたHTMLテーブルをパース
4. **データ整形**: 複数の検索結果を集約し、1行のデータに変換
5. **CSV出力**: UTF-8-SIG形式（Excelで日本語が正しく表示される）で保存

## トラブルシューティング

### ブラウザが開かない場合

- `main.py` の以下の行を確認してください：
  ```python
  # options.add_argument('--headless')  # コメント解除でヘッドレスモード
  ```

### 日付が選択できない場合

- スクリプトは対象施設が予約受付開始していない日付をスキップします
- 検索対象日が施設の受付期間外の可能性があります

### データが取得されない場合

- 対象ウェブサイトのHTMLレイアウトが変更された可能性があります
- `TARGET_URL` のURL形式が正しいか確認してください
- ブラウザで手動で施設を検索し、期待通りの結果が得られるか確認してください

## 注意事項

- このツールはWebスクレイピングを使用しています。ウェブサイトの利用規約を確認してから使用してください
- 大量のアクセスはサーバーに負荷をかける可能性があります
- ブラウザウィンドウは実行中に表示されるため（ヘッドレスモードを有効にしない場合）、実行中は操作しないでください
- 検索実行中は各リクエスト間に遅延（sleep）が組み込まれています

## ライセンス

このプロジェクトは個人利用を想定しています。

## 今後の改善案

- 複数のスポーツ種別を同時検索
- 特定の条件（時間帯、地域など）でのフィルタリング
- メール通知機能
- データベースへの保存
